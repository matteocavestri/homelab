repositories:
  - name: mojo2600
    url: https://mojo2600.github.io/pihole-kubernetes
releases:
  - name: pihole
    namespace: pihole-system
    chart: mojo2600/pihole
    version: 2.26.1
    values:
      - adlists: {}
      - adminPassword: {{ env "PIHOLE_PASS" | default "admin" }}
      - doh:
          enabled: true
          name: cloudflared
          pullPolicy: IfNotPresent
          repository: crazymax/cloudflared
          tag: 2024.6.1
          probes:
            liveness:
              enabled: true
              failureThreshold: 10
              initialDelaySeconds: 60
              probe: {'exec': {'command': ['nslookup', '-po=5053', 'cloudflare.com', '127.0.0.1']}}
              timeoutSeconds: 5
      - hostname: pihole-k3s
      - persistentVolumeClaim:
          enabled: true
          size: 512Mi
      - probes:
          liveness:
            failureThreshold: 10
            initialDelaySeconds: 60
            timeoutSeconds: 5
            type: httpGet
          readiness:
            enabled: true
            failureThreshold: 3
            initialDelaySeconds: 60
            port: http
            timeoutSeconds: 5
      - replicaCount: 1
      - resources:
          limits:
            cpu: 200m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
      - serviceDhcp:
          loadBalancerIP: {{ env "PIHOLE_IP" | default "192.168.1.250" }}
          annotations:
            metallb.universe.tf/allow-shared-ip: pihole-svc
          type: LoadBalancer
      - serviceDns:
          loadBalancerIP: {{ env "PIHOLE_IP" | default "192.168.1.250" }}
          annotations:
            metallb.universe.tf/allow-shared-ip: pihole-svc
          type: LoadBalancer
      - serviceWeb:
          loadBalancerIP: {{ env "PIHOLE_IP" | default "192.168.1.250" }}
          annotations:
            metallb.universe.tf/allow-shared-ip: pihole-svc
          type: LoadBalancer
      - strategyType: RollingUpdate
      - virtualHost: pi.hole
